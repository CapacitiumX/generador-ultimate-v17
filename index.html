<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador PRO V300 - Completo</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&family=Playfair+Display:wght@700&family=Roboto+Slab:wght@300;700&family=Lato:wght@300;900&family=Open+Sans:wght@400;800&family=Bebas+Neue&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.10.0/dist/pptxgen.bundle.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --primary: #2563eb; --dark: #0f172a; --bg: #e2e8f0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }

        /* =========================================
           ESTILOS GENERALES
           ========================================= */
        #app-container { display: block; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); min-height: 90vh; }
        
        .nav-tabs { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .nav-btn { padding: 12px 25px; border: none; background: #e2e8f0; border-radius: 50px; font-weight: bold; color: #64748b; cursor: pointer; transition: 0.3s; }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4); }
        .section { display: none; } .section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .editor-layout { display: grid; grid-template-columns: 350px 1fr; gap: 30px; height: calc(100vh - 180px); }
        .editor-sidebar { overflow-y: auto; padding-right: 10px; }
        .preview-area { background: #64748b; border-radius: 10px; display: flex; justify-content: center; padding: 40px; overflow-y: auto; align-items: flex-start;}
        
        .input-group { margin-bottom: 15px; background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; }
        .input-group h4 { margin: 0 0 10px 0; color: #334155; border-bottom: 2px solid #e2e8f0; padding-bottom: 5px; }
        .nice-input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 5px; margin-bottom: 8px; box-sizing: border-box; font-size: 14px; transition: 0.2s; }
        label { font-size: 0.85em; font-weight: 700; color: #64748b; text-transform: uppercase; }

        /* HERRAMIENTAS PPT MEJORADAS */
        .ppt-toolbar { display: flex; gap: 5px; margin-bottom: 10px; background: #fff; padding: 5px; border-radius: 5px; border: 1px solid #ccc; flex-wrap: wrap;}
        .tool-btn { flex: 1; border: none; background: #f1f5f9; cursor: pointer; border-radius: 3px; font-weight: bold; padding: 8px; min-width: 30px;}
        .tool-btn.active { background: #2563eb; color: white; }
        
        /* BOTONES DE COLOR R√ÅPIDO */
        .color-btn { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer; margin-right: 5px; display: inline-block; }
        .color-btn:hover { transform: scale(1.1); }
        .color-btn.selected { border-color: #2563eb; box-shadow: 0 0 5px rgba(37,99,235,0.5); }

        #cv-paper { width: 215.9mm; min-height: 279.4mm; background: white; box-shadow: 0 20px 40px rgba(0,0,0,0.4); position: relative; overflow: hidden; }

        /* =========================================
           LIMPIEZA DE IMPRESI√ìN
           ========================================= */
        @media print { 
            @page { margin: 0; size: auto; }
            body, html { margin: 0; padding: 0; background: white; height: 100%; -webkit-print-color-adjust: exact; }
            .nav-tabs, .editor-sidebar, h2, button, .input-group, input, .ppt-toolbar, select, #excelSelector { display: none !important; }
            #app-container { padding: 0; margin: 0; display: block !important; }
            .container { box-shadow: none; margin: 0; padding: 0; width: 100%; max-width: none; min-height: auto; }
            .preview-area { padding: 0; background: white; overflow: visible; display: block; }
            .section { display: none; }
            #cv { display: block !important; }
            #cv-paper { visibility: visible !important; position: absolute; left: 0; top: 0; margin: 0; width: 100%; height: 100%; box-shadow: none; z-index: 9999; }
            #cv-paper * { visibility: visible !important; }
        }
    </style>
</head>
<body>

    <div id="app-container">
        <div class="container">
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0; color:#1e293b;">Generador <span style="color:var(--primary)">V300</span> Completo</h2>
            </div>

            <div class="nav-tabs">
                <button class="nav-btn active" onclick="switchTab('cv')"><i class="fas fa-file-word"></i> 100 Dise√±os CV</button>
                <button class="nav-btn" onclick="switchTab('ppt')"><i class="fas fa-file-powerpoint"></i> PPT Editor PRO</button>
                <button class="nav-btn" onclick="switchTab('excel')"><i class="fas fa-file-excel"></i> Excel Din√°mico</button>
            </div>

            <div id="cv" class="section active">
                <div style="background:#1e293b; padding:15px; border-radius:10px; margin-bottom:20px; display:flex; gap:20px; align-items:center; color:white;">
                    <div style="flex:1;">
                        <strong>üé® Estilo / Arquitectura (1-100):</strong>
                        <input type="range" id="cvStyle" min="1" max="100" value="1" oninput="renderCV()" style="width:100%;">
                    </div>
                    <button onclick="downloadPDF()" style="background:#16a34a; border:none; padding:10px 20px; color:white; border-radius:5px; cursor:pointer; font-weight:bold;">IMPRIMIR / PDF</button>
                </div>

                <div class="editor-layout">
                    <div class="editor-sidebar">
                        <div class="input-group">
                            <h4>Datos Personales</h4>
                            <label>Foto:</label> <input type="file" onchange="loadImg(this, 'cv')" class="nice-input">
                            <label>Nombre:</label> <input id="cvName" class="nice-input" value="TU NOMBRE" onkeyup="renderCV()">
                            <label>T√≠tulo:</label> <input id="cvTitle" class="nice-input" value="PROFESIONAL" onkeyup="renderCV()">
                            <label>Contacto:</label> <input id="cvContact" class="nice-input" value="Tel√©fono | Email" onkeyup="renderCV()">
                        </div>
                        <div class="input-group">
                            <h4>Perfil</h4>
                            <textarea id="cvProfile" class="nice-input" rows="4" onkeyup="renderCV()">Resumen profesional...</textarea>
                        </div>
                        
                        <div class="input-group">
                            <h4>Experiencia (Texto Libre)</h4>
                            <textarea id="cvExperience" class="nice-input" rows="8" onkeyup="renderCV()" placeholder="Escribe aqu√≠ toda tu experiencia libremente..."></textarea>
                        </div>

                        <div class="input-group">
                            <h4>Educaci√≥n <button onclick="addEdu()" style="float:right; background:#2563eb; color:white; border:none; border-radius:3px; cursor:pointer;">+</button></h4>
                            <div id="edu-list"></div>
                        </div>

                        <div class="input-group">
                            <h4>Seminarios <button onclick="addSeminar()" style="float:right; background:#2563eb; color:white; border:none; border-radius:3px; cursor:pointer;">+</button></h4>
                            <div id="seminar-list"></div>
                        </div>

                        <div class="input-group">
                            <h4>Certificaciones <button onclick="addCert()" style="float:right; background:#2563eb; color:white; border:none; border-radius:3px; cursor:pointer;">+</button></h4>
                            <div id="cert-list"></div>
                        </div>

                        <div class="input-group">
                            <h4>Habilidades <button onclick="addSkill()" style="float:right;">+</button></h4>
                            <div id="skill-list"></div>
                        </div>
                    </div>
                    <div class="preview-area">
                        <div id="cv-paper"></div>
                    </div>
                </div>
            </div>

            <div id="ppt" class="section">
                <div style="background:#ea580c; padding:15px; border-radius:10px; margin-bottom:20px; display:flex; gap:20px; align-items:center; color:white;">
                    <div style="flex:1;">
                        <strong>üìä Dise√±o (1-100):</strong>
                        <input type="range" id="pptStyle" min="1" max="100" value="1" oninput="renderPPT()" style="width:100%;">
                    </div>
                    <button onclick="downloadPPTX()" style="background:white; color:#ea580c; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-weight:bold;">DESCARGAR .PPTX</button>
                </div>
                <div class="editor-layout">
                    <div class="editor-sidebar">
                        <div class="input-group">
                            <h4>Contenido PPT</h4>
                            <label>Logo:</label> <input type="file" onchange="loadImg(this, 'ppt')" class="nice-input">
                            <label>T√≠tulo:</label> <input id="pptTitleInput" class="nice-input" value="ESTRATEGIA 2025" onkeyup="renderPPT()">
                            <label>Subt√≠tulo:</label> <input id="pptSubInput" class="nice-input" value="Plan de Crecimiento" onkeyup="renderPPT()">
                            <label>Presentador:</label> <input id="pptNameInput" class="nice-input" value="Lic. Juan P√©rez" onkeyup="renderPPT()">
                            <label>Color Texto:</label> <input type="color" id="pptTextColor" onchange="setPPTColor(this.value)" value="#333333" class="nice-input" style="height:40px;">
                            <div class="ppt-toolbar" style="margin-top:10px;">
                                <button class="tool-btn" onclick="togglePPTStyle('bold')" id="btnBold"><i class="fas fa-bold"></i></button>
                                <button class="tool-btn" onclick="togglePPTStyle('italic')" id="btnItalic"><i class="fas fa-italic"></i></button>
                                <div style="width:1px; background:#ddd; margin:0 5px;"></div>
                                <button class="tool-btn" onclick="setPPTAlign('left')" id="btnLeft"><i class="fas fa-align-left"></i></button>
                                <button class="tool-btn" onclick="setPPTAlign('center')" id="btnCenter"><i class="fas fa-align-center"></i></button>
                                <button class="tool-btn" onclick="setPPTAlign('right')" id="btnRight"><i class="fas fa-align-right"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="preview-area">
                        <canvas id="pptCanvas" width="960" height="540"></canvas>
                    </div>
                </div>
            </div>

            <div id="excel" class="section">
                <div style="background:#15803d; padding:15px; border-radius:10px; margin-bottom:20px; display:flex; gap:20px; align-items:center; color:white;">
                    <div style="flex:1;">
                        <strong>üìà Selecciona Plantilla:</strong>
                        <select id="excelSelector" onchange="renderExcel()" style="padding:10px; border-radius:5px; width:70%; font-weight:bold;"></select>
                    </div>
                    <div>
                        Color: <input type="range" id="excelColor" min="1" max="100" oninput="renderExcel()">
                    </div>
                    <button onclick="downloadExcel()" style="background:white; color:#15803d; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-weight:bold;">DESCARGAR EXCEL</button>
                </div>
                <div id="excel-preview-box" style="overflow-x:auto; background:white; padding:30px; box-shadow: inset 0 0 20px #f1f5f9; min-height:500px; border-radius:10px;"></div>
            </div>

        </div>
    </div>

    <script>
        let pptConfig = { bold: false, italic: false, align: 'center', color: '#333333' };
        let excelConfig = { currentTemplate: null };

        window.onload = initSystem;

        // ESTRUCTURA DE DATOS ACTUALIZADA CON SEMINARIOS Y CERTIFICACIONES
        let cvData = { 
            photo: null, 
            experienceText: "Gerente de Operaciones | 2020 - Presente\nLider√© un equipo de 20 personas logrando un 15% de aumento en eficiencia.\n\nAnalista Senior | 2018 - 2020\nResponsable del an√°lisis de datos y reportes ejecutivos.", 
            edus: [], 
            seminars: [], // Nuevo
            certs: [],    // Nuevo
            skills: ['Liderazgo', 'Excel'] 
        };
        
        let pptData = { logo: null };
        
        const themes = [
            { main: '#2c3e50', sec: '#e74c3c', bg: '#fdfbf7', font: 'Montserrat', fontHead: 'Bebas Neue' },
            { main: '#1e3a8a', sec: '#3b82f6', bg: '#ffffff', font: 'Poppins', fontHead: 'Poppins' },
            { main: '#064e3b', sec: '#10b981', bg: '#f0fdf4', font: 'Playfair Display', fontHead: 'Playfair Display' },
            { main: '#4c1d95', sec: '#8b5cf6', bg: '#f5f3ff', font: 'Lato', fontHead: 'Lato' },
            { main: '#000000', sec: '#666666', bg: '#ffffff', font: 'Open Sans', fontHead: 'Montserrat' }
        ];

        function initSystem() {
            initExcelList(); 
            document.getElementById('cvExperience').value = cvData.experienceText; 
            addEdu(); 
            // Inicializar con un elemento vac√≠o en las nuevas secciones si se desea, o dejar vac√≠o.
            renderCV(); 
            renderPPT(); 
            renderExcel();
            updatePPTButtons();
        }

        // --- CV ENGINE ---
        function renderCV() {
            const styleIdx = parseInt(document.getElementById('cvStyle').value);
            const theme = themes[(styleIdx - 1) % themes.length];
            let layoutType = (styleIdx % 3) + 1;
            const paper = document.getElementById('cv-paper');
            const name = document.getElementById('cvName').value;
            const title = document.getElementById('cvTitle').value;
            const contact = document.getElementById('cvContact').value;
            const profile = document.getElementById('cvProfile').value;
            
            cvData.experienceText = document.getElementById('cvExperience').value;
            const expHTML = cvData.experienceText.replace(/\n/g, '<br>');

            let photoHTML = cvData.photo ? `<img src="${cvData.photo}" style="width:100%; height:100%; object-fit:cover;">` : `<div style="background:#eee; width:100%; height:100%;"></div>`;

            // GENERADORES DE HTML PARA LISTAS
            const eduHTML = cvData.edus.map(e => `<div style="margin-bottom:8px;"><strong>${e.t}</strong> <span style="opacity:0.7">| ${e.y}</span><br><small>${e.s}</small></div>`).join('');
            
            // HTML PARA SEMINARIOS Y CERTIFICACIONES
            const seminarHTML = cvData.seminars.length > 0 ? 
                `<h4>SEMINARIOS</h4>` + cvData.seminars.map(e => `<div style="margin-bottom:8px;"><strong>${e.t}</strong> <span style="opacity:0.7">| ${e.y}</span><br><small>${e.s}</small></div>`).join('') 
                : '';

            const certHTML = cvData.certs.length > 0 ? 
                `<h4>CERTIFICACIONES</h4>` + cvData.certs.map(e => `<div style="margin-bottom:8px;"><strong>${e.t}</strong> <span style="opacity:0.7">| ${e.y}</span><br><small>${e.s}</small></div>`).join('') 
                : '';

            let html = `<div style="font-family: '${theme.font}', sans-serif; color: #333; height: 100%;">`;

            if(layoutType === 1) { // Sidebar Layout
                html += `
                <div style="display:grid; grid-template-columns: 32% 68%; height:100%;">
                    <div style="background:${theme.main}; color:white; padding:40px 20px;">
                        <div style="width:140px; height:140px; border-radius:50%; overflow:hidden; margin:0 auto 30px auto; border:4px solid white;">${photoHTML}</div>
                        <h2 style="text-align:center;">${name}</h2>
                        <p style="text-align:center; opacity:0.8;">${title}</p>
                        <hr style="border-color:rgba(255,255,255,0.2);">
                        <p>${contact}</p>
                        <h4>HABILIDADES</h4>
                        ${cvData.skills.map(s=>`<div>‚Ä¢ ${s}</div>`).join('')}
                        
                        <h4 style="margin-top:30px;">EDUCACI√ìN</h4>
                        ${eduHTML}
                    </div>
                    <div style="padding:40px;">
                        <h3 style="color:${theme.main}; border-bottom:2px solid ${theme.sec};">PERFIL</h3>
                        <p>${profile}</p>
                        <h3 style="color:${theme.main}; border-bottom:2px solid ${theme.sec}; margin-top:30px;">EXPERIENCIA</h3>
                        <div style="line-height:1.6; margin-bottom:20px;">${expHTML}</div>
                        
                        <div style="margin-top:20px;">${seminarHTML}</div>
                        <div style="margin-top:20px;">${certHTML}</div>
                    </div>
                </div>`;
            } else if(layoutType === 2) { // Header Top
                html += `
                <div style="padding:50px;">
                    <div style="border-bottom:5px solid ${theme.main}; padding-bottom:20px; display:flex; gap:30px;">
                        <div style="width:100px; height:100px; border-radius:10px; overflow:hidden;">${photoHTML}</div>
                        <div>
                            <h1 style="color:${theme.main}; margin:0;">${name}</h1>
                            <h3 style="color:${theme.sec}; margin:0;">${title}</h3>
                            <small>${contact}</small>
                        </div>
                    </div>
                    <div style="margin-top:30px; columns:2; column-gap:40px;">
                        <div style="break-inside: avoid;"><h4>PERFIL</h4> <p>${profile}</p></div>
                        <div style="break-inside: avoid;"><h4>EDUCACI√ìN</h4> ${eduHTML}</div>
                        <div style="break-inside: avoid;">
                            <h4>EXPERIENCIA</h4>
                            <div style="background:#f9f9f9; padding:15px; border-radius:5px;">${expHTML}</div>
                        </div>
                        <div style="break-inside: avoid; margin-top:20px;">${seminarHTML}</div>
                        <div style="break-inside: avoid; margin-top:20px;">${certHTML}</div>
                    </div>
                </div>`;
            } else { // Minimal
                html += `
                <div style="padding:60px; text-align:center;">
                    <h1 style="font-size:40px; letter-spacing:5px;">${name}</h1>
                    <p style="text-transform:uppercase; color:${theme.sec};">${title}</p>
                    <div style="margin:30px auto; width:50px; height:2px; background:black;"></div>
                    <div style="text-align:left; padding:0 50px;">
                        <h4>PERFIL</h4> <p>${profile}</p>
                        <h4>EXPERIENCIA</h4>
                        <div style="border-left:3px solid ${theme.main}; padding-left:15px; margin-bottom:20px;">${expHTML}</div>
                        <h4>EDUCACI√ìN</h4> ${eduHTML}
                        <div style="margin-top:20px;">${seminarHTML}</div>
                        <div style="margin-top:20px;">${certHTML}</div>
                    </div>
                </div>`;
            }
            html += `</div>`;
            paper.innerHTML = html;
        }

        // --- FUNCIONES DE EDICI√ìN ---

        // EDUCACI√ìN
        function addEdu(){ 
            const index = cvData.edus.length;
            cvData.edus.push({t:'Carrera/Curso', s:'Escuela/Plataforma', y:'2025'});
            createInputBlock('edu-list', index, 'edu', 'Carrera', 'Instituci√≥n', 'A√±o');
            renderCV();
        }
        function updateEduData(idx, field, val) { cvData.edus[idx][field] = val; renderCV(); }

        // SEMINARIOS (NUEVO)
        function addSeminar(){ 
            const index = cvData.seminars.length;
            cvData.seminars.push({t:'Nombre Seminario', s:'Organizador', y:'2025'});
            createInputBlock('seminar-list', index, 'seminar', 'Seminario', 'Organizador', 'A√±o');
            renderCV();
        }
        function updateSeminarData(idx, field, val) { cvData.seminars[idx][field] = val; renderCV(); }

        // CERTIFICACIONES (NUEVO)
        function addCert(){ 
            const index = cvData.certs.length;
            cvData.certs.push({t:'Nombre Certificaci√≥n', s:'Emisor', y:'2025'});
            createInputBlock('cert-list', index, 'cert', 'Certificaci√≥n', 'Emisor', 'A√±o');
            renderCV();
        }
        function updateCertData(idx, field, val) { cvData.certs[idx][field] = val; renderCV(); }

        // HELPER PARA CREAR INPUTS
        function createInputBlock(containerId, index, type, ph1, ph2, ph3) {
            const div = document.createElement('div');
            div.style.marginBottom = "15px"; div.style.borderBottom = "1px solid #ddd"; div.style.paddingBottom = "5px";
            
            // Funci√≥n din√°mica de actualizaci√≥n
            const fnName = type === 'edu' ? 'updateEduData' : (type === 'seminar' ? 'updateSeminarData' : 'updateCertData');
            
            div.innerHTML = `
                <input class="nice-input" placeholder="${ph1}" oninput="${fnName}(${index},'t',this.value)">
                <input class="nice-input" placeholder="${ph2}" oninput="${fnName}(${index},'s',this.value)">
                <input class="nice-input" placeholder="${ph3}" oninput="${fnName}(${index},'y',this.value)">
            `;
            document.getElementById(containerId).appendChild(div);
        }

        // SKILLS
        function addSkill(){ 
            const skill = prompt("Ingresa la habilidad:");
            if(skill) { cvData.skills.push(skill); renderCV(); }
        }
        
        // IMAGENES
        function loadImg(input, type) {
            if(input.files[0]) {
                const r = new FileReader();
                r.onload = e => {
                    if(type==='cv') cvData.photo = e.target.result;
                    if(type==='ppt') pptData.logo = e.target.result;
                    renderCV(); renderPPT();
                }
                r.readAsDataURL(input.files[0]);
            }
        }

        // PPT FUNCIONES
        function togglePPTStyle(type) {
            if(type === 'bold') pptConfig.bold = !pptConfig.bold;
            if(type === 'italic') pptConfig.italic = !pptConfig.italic;
            updatePPTButtons(); renderPPT();
        }
        function setPPTAlign(align) { pptConfig.align = align; updatePPTButtons(); renderPPT(); }
        function setPPTColor(color) { pptConfig.color = color; document.getElementById('pptTextColor').value = color; renderPPT(); }
        function updatePPTButtons() {
            document.getElementById('btnBold').className = pptConfig.bold ? 'tool-btn active' : 'tool-btn';
            document.getElementById('btnItalic').className = pptConfig.italic ? 'tool-btn active' : 'tool-btn';
            ['left', 'center', 'right'].forEach(a => {
                document.getElementById('btn'+a.charAt(0).toUpperCase()+a.slice(1)).className = (pptConfig.align === a) ? 'tool-btn active' : 'tool-btn';
            });
        }
        function renderPPT() {
            const canvas = document.getElementById('pptCanvas');
            const ctx = canvas.getContext('2d');
            const styleIdx = parseInt(document.getElementById('pptStyle').value);
            const theme = themes[(styleIdx - 1) % themes.length];
            ctx.clearRect(0,0,960,540);
            const grd = ctx.createLinearGradient(0,0,960,540);
            grd.addColorStop(0, "white"); grd.addColorStop(1, theme.bg);
            ctx.fillStyle = grd; ctx.fillRect(0,0,960,540);
            ctx.fillStyle = theme.main;
            if (styleIdx % 2 === 0) { ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(960,0); ctx.lineTo(960,100); ctx.lineTo(0,400); ctx.fill(); } 
            else { ctx.fillRect(0,0,300,540); }
            if(pptData.logo) {
                const img = new Image(); img.src = pptData.logo;
                try { ctx.drawImage(img, 850, 30, 80, 80); } catch(e){}
            }
            const title = document.getElementById('pptTitleInput').value;
            const sub = document.getElementById('pptSubInput').value;
            const presenter = document.getElementById('pptNameInput').value;
            let fontStr = ""; if(pptConfig.italic) fontStr += "italic "; if(pptConfig.bold) fontStr += "bold ";
            let alignX = 480; if(pptConfig.align === 'left') alignX = 50; if(pptConfig.align === 'right') alignX = 910;
            ctx.textAlign = pptConfig.align;
            ctx.fillStyle = pptConfig.color; ctx.font = `${fontStr} 55px ${theme.fontHead}`; ctx.fillText(title, alignX, 250);
            ctx.fillStyle = theme.sec; ctx.font = `32px ${theme.font}`; ctx.fillText(sub, alignX, 300);
            ctx.fillStyle = "#555"; ctx.font = "20px Arial"; ctx.fillText(presenter, alignX, 480);
        }

        // EXCEL FUNCIONES
        const excelTemplates = {
            'Presupuesto': { cols: ['Categor√≠a', 'Presupuestado', 'Real', 'Diferencia', 'Estado'], data: [['Vivienda', '$1,500', '$1,500', '$0', 'OK'], ['Comida', '$800', '$950', '-$150', 'Alerta'], ['Transporte', '$300', '$250', '+$50', 'OK'], ['Ahorro', '$200', '$100', '-$100', 'Bajo']] },
            'N√≥mina': { cols: ['ID Emp', 'Nombre', 'Cargo', 'Salario Bruto', 'Impuestos', 'Neto'], data: [['001', 'Juan P√©rez', 'Gerente', '$5,000', '$1,000', '$4,000'], ['002', 'Ana G√≥mez', 'Analista', '$3,000', '$600', '$2,400'], ['003', 'Luis Sol√≠s', 'Auxiliar', '$1,800', '$200', '$1,600']] },
            'Inventario': { cols: ['SKU', 'Producto', 'Stock M√≠n', 'Stock Actual', 'Costo Unit', 'Valor Total'], data: [['A-100', 'Laptop Pro', '10', '45', '$800', '$36,000'], ['B-200', 'Mouse BT', '50', '12', '$20', '$240'], ['C-300', 'Monitor 4K', '15', '18', '$300', '$5,400']] },
            'Ventas': { cols: ['Fecha', 'Cliente', 'Producto', 'Cantidad', 'Precio', 'Total'], data: [['01/12/25', 'Empresa X', 'Servicio Web', '1', '$1500', '$1500'], ['02/12/25', 'Cliente Y', 'Licencia', '5', '$100', '$500'], ['05/12/25', 'Empresa Z', 'Consultor√≠a', '10', '$80', '$800']] },
            'Escuela': { cols: ['Matr√≠cula', 'Alumno', 'Matem√°ticas', 'Historia', 'Ciencias', 'Promedio'], data: [['A001', 'Roberto D.', '9.5', '8.0', '9.0', '8.8'], ['A002', 'Maria F.', '10.0', '10.0', '9.5', '9.8'], ['A003', 'Carlos G.', '6.0', '7.5', '7.0', '6.8']] }
        };
        function initExcelList() {
            const s = document.getElementById('excelSelector');
            const cats = ['Presupuesto','N√≥mina','Inventario','Ventas','Escuela'];
            s.innerHTML = "";
            for(let i=0; i<100; i++) {
                let catName = cats[i % cats.length];
                let opt = document.createElement('option');
                opt.value = catName; opt.text = `${i+1}. Plantilla ${catName} - Estilo PRO ${Math.ceil((i+1)/5)}`; s.add(opt);
            }
        }
        function renderExcel() {
            const h = document.getElementById('excel-preview-box');
            const selector = document.getElementById('excelSelector');
            const selectedCat = selector.value || 'Presupuesto';
            const template = excelTemplates[selectedCat] || excelTemplates['Presupuesto'];
            excelConfig.currentTemplate = template;
            const val = document.getElementById('excelColor').value;
            let color = '#2563eb'; if(val > 33) color = '#15803d'; if(val > 66) color = '#b91c1c';
            let html = `<h2 style="color:${color}; font-family:'Arial'; border-bottom:2px solid ${color}; padding-bottom:10px;">Plantilla: ${selectedCat}</h2>`;
            html += `<table style="width:100%; border-collapse:collapse; font-family:Arial, sans-serif; font-size:14px;"><thead><tr style="background:${color}; color:white;">`;
            template.cols.forEach(col => { html += `<th style="padding:12px; text-align:left;">${col}</th>`; });
            html += `</tr></thead><tbody>`;
            template.data.forEach((row, i) => {
                let bg = (i % 2 === 0) ? '#fff' : '#f8f9fa';
                html += `<tr style="background:${bg}; border-bottom:1px solid #ddd;">`;
                row.forEach(cell => {
                    let cellColor = (cell.includes('-') || cell === 'Alerta' || cell === 'Bajo') ? 'red' : '#333';
                    if(cell === 'OK') cellColor = 'green';
                    html += `<td style="padding:12px; color:${cellColor};">${cell}</td>`;
                });
                html += `</tr>`;
            });
            html += `</tbody></table>`;
            h.innerHTML = html;
        }
        function downloadExcel() {
            const template = excelConfig.currentTemplate; if(!template) return;
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([template.cols, ...template.data]);
            XLSX.utils.book_append_sheet(wb, ws, "Hoja1");
            XLSX.writeFile(wb, `${document.getElementById('excelSelector').value || "Plantilla"}_Nivel_Dios.xlsx`);
        }
        function downloadPDF() { window.print(); }
        function downloadPPTX() { 
            let pptx = new PptxGenJS(); let slide = pptx.addSlide();
            slide.addText(document.getElementById('pptTitleInput').value, { x:1, y:2, fontSize:30, color:pptConfig.color.replace('#','') });
            pptx.writeFile({ fileName: "Presentacion_V300.pptx" });
        }
        function switchTab(id) { document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    </script>
</body>
</html>
